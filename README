l2tpvpn

l2tpvpn module is a puppet (http://puppetlabs.com/) module that can be used to deploy a L2TP VPN quickly in Ubuntu.

Currently, this module is only verified in puppet v3.0.1 in Ubuntu 12.04 in Windows Azure cloud environment.

It is developped primarily to set up a VPN quickly to climb over the Great Fire Wall for personal use.

Usage
-------
1. Install Puppet
  * Run "curl -L https://raw.github.com/niyue/l2tpvpn/master/bin/install_puppet.sh | bash -s", which is an automated version of http://docs.puppetlabs.com/guides/puppetlabs_package_repositories.html#for-debian-and-ubuntu
  * sudo apt-get install puppet
  * This should install puppet 3.0 or later.

2. Download the l2tpvpn module
  * Install git, sudo apt-get install git
  * git clone https://github.com/niyue/l2tpvpn.git

3. Modify username/password
  * cd l2tpvpn
  * Modify the username/password in tests/init.pp by changing the key/value pair for 'credentials' hash
    * change 'shared_key' and credentials to anything you like, and you will use them in step #6 when setting up your VPN client

3. Install and apply puppet module
  * run "bash ./bin/install_module.sh"
  * sudo puppet apply /usr/share/puppet/modules/l2tpvpn/tests/init.pp

4. Redirect script
  * sudo /usr/share/puppet/modules/l2tpvpn/bin/redirect.sh

5. Open UDP ports
  * If the server is hosted behind a fire wall, please ensure UDP ports 500 and 4500 are open to allow clients to connect.

6. That's it
  * Now you can connect your iOS/Android client to the L2TP VPN server via the credentials specified above

7. Just in case it doesn't work (more efforts are needed to try all the above things in a clean environment), after applying init.pp, try to restart all the related services:
    1. sudo service pppd-dns restart
    2. sudo service xl2tpd restart
    3. sudo service ipsec restart

License
-------
http://www.apache.org/licenses/LICENSE-2.0.html

Contact
-------
Ni Yue (niyue.com AT gmai1 d0t c0m)

Support
-------

Just drop me an email.
